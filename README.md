## 技术原理
802.11是IEEE制定的无线局域网协议，它是以802.2的逻辑链路控制封装来携带IP封包，所以它能以802.2 SNAP格式接收无线网络数据。  
如果开启wifi芯片的混杂模式监听空间中的无线信号，并以802.2 SNAP格式从数据链路层截取数据，就会得到如下图所示的数据包：    
![add image](https://github.com/marginleft/AirKissLibrary/raw/master/doc/image1.png)  
DA：目标mac地址；  
SA：源mac地址；  
Length：后面数据的长度；  
LLC：LLC头；  
SNAP：3bytes的厂商标识和2bytes的协议类型标识；  
DATA：负载，对于加密信道来说是密文的；  
FCS：帧检验序列。  
从无线信号接收方来说，不管无线信道有没有加密，DA、SA、Length、LLC、SNAP、FCS字段总是暴露的，因此无限信号接收方是能获取这6个字段信息的。  
从无线信号发送方来说，由于操作系统的限制，DA、SA、LLC、SNAP、FCS字段的信息获取需要很高的控制权限，也就是说发送方是很难拿到这5个字段信息，那么就只剩下Length字段了，发送方可以通过改变其所需要发送数据包的长度进行控制，所以只要制定出一套利用长度编码的通信协议就可以利用802.2 SNAP数据包中的Length字段进行信息传递。  
无线信号发送方向空间中发送一系列的UDP广播包，其中每一个包的长度（即Length字段）都按照AirKiss通信协议进行编码，无线信号接收方利用混杂模式监听空间中的无线信号，并从数据链路层截取802.2 SNAP格式数据包就可以拿到已编码的Length字段，随后无线信号接收方就可以根据AirKiss通信协议解析出需要的信息。
## AirKiss通信协议
在发送链路层数据之前，需要先发送前导域，它是由4个字节组成，其值固定为{1, 2, 3, 4}。  
作用：无线信号接收方通过监听，在链路层截获802.2 SNAP格式的前导域数据包，其Length字段的值为53，那差异值就是53 - 1 = 52，然后接收到数据后
用差异值即能得到实际的信息数据。  
链路层数据结构由magic、prefix和sequence组成。   
magic：  

| 高位 | 低位 |
| ---- |---- |
| 0x0 | 数据长度的高4位 |
| 0x1 | 数据长度的低4位 |
| 0x2 | ssid的CRC8值的高4位 |
| 0x3 | ssid的CRC8值的低4位 |  
  
prefix：  

| 高位 | 低位 |
| ---- |---- |
| 0x4 | 密码长度的高4位 |
| 0x5 | 密码长度的低4位 |
| 0x6 | 密码长度的CRC8值的高4位 |
| 0x7 | 密码长度的CRC8值的低4位 | 
   
sequence：  
把待发送的数据以4位粒度进行划分，每4个数据组成一个sequence，每个sequence都由sequence header和data组成。  
需要注意的是，最后一个sequence如果不足4位，不用补全。   
sequence header：  
 
| 高位 | 低位 |
| ---- |---- |
| 0x8 | 划分序号和数据的CRC8值的低7位 |
| 0x8 | 划分序号的低7位 |  
  
data：  

| 高位 | 低位 |
| ---- |---- |
| 0x10 | 第一个数据的低8位 |
| 0x10 | 第二个数据的低8位 |
| 0x10 | 第三个数据的低8位 |
| 0x10 | 第四个数据的低8位 |  
  
无线信号发送方需要发送的数据由三部分组成：密码（AES加密）、随机数、SSID（AES加密）。  
随机数的作用：当无线信号接收方连上AP之后会发送以该随机数为内容的UDP广播包，当无线信号发送方接收到该广播包后就能确认无线信号接收方已经准确接收到数据。  


